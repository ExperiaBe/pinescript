// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© RicardoSantos

//@version=4
study(title="test-007-mode")

var label debug = label.new(x=bar_index, y=0.0, text='', style=label.style_label_lower_left)
f_print(_array, _label)=>
    int _size = array.size(id=_array) - 1
    string _t = ''
    if _size > 0
        for _i = 0 to _size
            _t := _t + tostring(_i, '# : ') + tostring(array.get(id=_array, index=_i)) + '\n'
    label.set_xy(id=_label, x=bar_index, y=0.0)
    label.set_text(id=_label, text=_t)
    
f_push(_id, _value)=>
    _e = array.pop(id=_id)
    array.insert(id=_id, index=0, value=_value)

int length = input(10)
float src = close//bar_index % length
var float[] prices = array.newfloat(size=length, initial_value=close)
f_push(prices, src)

f_mode(_id)=>
    int _size = array.size(id=_id)
    int _target = _size % 2 == 0 ? _size / 2 : 1 + _size / 2
    float[] _sorted = array.copy(id=_id)
    array.sort(id=_sorted, order=true)
    //f_print(_sorted, debug)
    float _return = 0.
    if _size > 0
        _return := array.get(id=_sorted, index=_target)
    _return

float mode = f_mode(prices)
plot(src, color=color.gray)
plot(mode)