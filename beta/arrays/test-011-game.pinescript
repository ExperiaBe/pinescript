// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© RicardoSantos

//@version=4
study("test-011-game")
int msize = 7
var int[] A = array.newint(size=msize, initial_value=0)
var int[] B = array.newint(size=msize, initial_value=0)
var int[] C = array.newint(size=msize, initial_value=0)
var int[] D = array.newint(size=msize, initial_value=0)
var int[] E = array.newint(size=msize, initial_value=0)
var int[] F = array.newint(size=msize, initial_value=0)
var int[] G = array.newint(size=msize, initial_value=0)
var int[] H = array.newint(size=msize, initial_value=0)

f_xdim(_i)=>(_i==0?A:(_i==1?B:(_i==2?C:(_i==3?D:(_i==4?E:(_i==5?F:(_i==6?G:(_i==7?H:A))))))))

for _i=0 to msize
    _ref_current_array = f_xdim(_i)
    for _j=0 to msize
        int _north_cell = array.get(id=f_xdim((_i - 1) % (msize + 1)), index=_j)
        int _south_cell = array.get(id=f_xdim((_i + 1) % (msize + 1)), index=_j)
        int _west_cell = array.get(id=_ref_current_array, index=(_j - 1) % (msize + 1))
        int _east_cell = array.get(id=_ref_current_array, index=(_j + 1) % (msize + 1))
        int _sum_cells = _north_cell + _south_cell + _west_cell + _east_cell
        int _current_cell = array.get(id=_ref_current_array, index=_j)
        // rules:
        if _current_cell > 0
            if _sum_cells > 1 and _sum_cells < 4
                array.set(id=_ref_current_array, index=_j, value=1)
            else
                array.set(id=_ref_current_array, index=_j, value=0)
        else        
            if _sum_cells == 3
                array.set(id=_ref_current_array, index=_j, value=1)
            else
                array.set(id=_ref_current_array, index=_j, value=0)

//
plot(series=array.get(id=A, index=0) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-7, show_last=1)
plot(series=array.get(id=A, index=1) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-6, show_last=1)
plot(series=array.get(id=A, index=2) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-5, show_last=1)
plot(series=array.get(id=A, index=3) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-4, show_last=1)
plot(series=array.get(id=A, index=4) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-3, show_last=1)
plot(series=array.get(id=A, index=5) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-2, show_last=1)
plot(series=array.get(id=A, index=6) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-1, show_last=1)
plot(series=array.get(id=A, index=7) ? 1.0 : 0.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=0.0, offset=-0, show_last=1)

plot(series=array.get(id=B, index=0) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-7, show_last=1)
plot(series=array.get(id=B, index=1) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-6, show_last=1)
plot(series=array.get(id=B, index=2) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-5, show_last=1)
plot(series=array.get(id=B, index=3) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-4, show_last=1)
plot(series=array.get(id=B, index=4) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-3, show_last=1)
plot(series=array.get(id=B, index=5) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-2, show_last=1)
plot(series=array.get(id=B, index=6) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-1, show_last=1)
plot(series=array.get(id=B, index=7) ? 2.0 : 1.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=1.0, offset=-0, show_last=1)

plot(series=array.get(id=C, index=0) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-7, show_last=1)
plot(series=array.get(id=C, index=1) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-6, show_last=1)
plot(series=array.get(id=C, index=2) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-5, show_last=1)
plot(series=array.get(id=C, index=3) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-4, show_last=1)
plot(series=array.get(id=C, index=4) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-3, show_last=1)
plot(series=array.get(id=C, index=5) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-2, show_last=1)
plot(series=array.get(id=C, index=6) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-1, show_last=1)
plot(series=array.get(id=C, index=7) ? 3.0 : 2.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=2.0, offset=-0, show_last=1)

plot(series=array.get(id=D, index=0) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-7, show_last=1)
plot(series=array.get(id=D, index=1) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-6, show_last=1)
plot(series=array.get(id=D, index=2) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-5, show_last=1)
plot(series=array.get(id=D, index=3) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-4, show_last=1)
plot(series=array.get(id=D, index=4) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-3, show_last=1)
plot(series=array.get(id=D, index=5) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-2, show_last=1)
plot(series=array.get(id=D, index=6) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-1, show_last=1)
plot(series=array.get(id=D, index=7) ? 4.0 : 3.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=3.0, offset=-0, show_last=1)

plot(series=array.get(id=E, index=0) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-7, show_last=1)
plot(series=array.get(id=E, index=1) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-6, show_last=1)
plot(series=array.get(id=E, index=2) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-5, show_last=1)
plot(series=array.get(id=E, index=3) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-4, show_last=1)
plot(series=array.get(id=E, index=4) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-3, show_last=1)
plot(series=array.get(id=E, index=5) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-2, show_last=1)
plot(series=array.get(id=E, index=6) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-1, show_last=1)
plot(series=array.get(id=E, index=7) ? 5.0 : 4.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=4.0, offset=-0, show_last=1)

plot(series=array.get(id=F, index=0) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-7, show_last=1)
plot(series=array.get(id=F, index=1) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-6, show_last=1)
plot(series=array.get(id=F, index=2) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-5, show_last=1)
plot(series=array.get(id=F, index=3) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-4, show_last=1)
plot(series=array.get(id=F, index=4) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-3, show_last=1)
plot(series=array.get(id=F, index=5) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-2, show_last=1)
plot(series=array.get(id=F, index=6) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-1, show_last=1)
plot(series=array.get(id=F, index=7) ? 6.0 : 5.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=5.0, offset=-0, show_last=1)

plot(series=array.get(id=G, index=0) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-7, show_last=1)
plot(series=array.get(id=G, index=1) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-6, show_last=1)
plot(series=array.get(id=G, index=2) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-5, show_last=1)
plot(series=array.get(id=G, index=3) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-4, show_last=1)
plot(series=array.get(id=G, index=4) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-3, show_last=1)
plot(series=array.get(id=G, index=5) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-2, show_last=1)
plot(series=array.get(id=G, index=6) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-1, show_last=1)
plot(series=array.get(id=G, index=7) ? 7.0 : 6.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=6.0, offset=-0, show_last=1)

plot(series=array.get(id=H, index=0) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-7, show_last=1)
plot(series=array.get(id=H, index=1) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-6, show_last=1)
plot(series=array.get(id=H, index=2) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-5, show_last=1)
plot(series=array.get(id=H, index=3) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-4, show_last=1)
plot(series=array.get(id=H, index=4) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-3, show_last=1)
plot(series=array.get(id=H, index=5) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-2, show_last=1)
plot(series=array.get(id=H, index=6) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-1, show_last=1)
plot(series=array.get(id=H, index=7) ? 8.0 : 7.0, title='', color=color.blue, style=plot.style_columns, transp=20, histbase=7.0, offset=-0, show_last=1)
